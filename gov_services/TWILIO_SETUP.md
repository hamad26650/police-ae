# 📱 دليل إعداد Twilio للرسائل النصية

## 🎯 نظرة عامة

تم تطبيق نظام إرسال الرسائل النصية (SMS) باستخدام Twilio API. عند رد الموظف على استعلام المتعامل، يتم إرسال رسالة نصية تلقائياً إلى رقم هاتف المتعامل.

---

## 📝 الخطوة 1: التسجيل في Twilio (5 دقائق)

### 1. افتح موقع Twilio:
```
https://www.twilio.com/try-twilio
```

### 2. أنشئ حساب مجاني:
- اضغط **"Sign up"**
- املأ بياناتك (الاسم، الإيميل، كلمة المرور)
- تحقق من الإيميل

### 3. أكمل التسجيل:
- اختر "SMS" كـ Product
- اختر "Python" كـ Language
- اختر "I want to send SMS"

### 4. احصل على $15 رصيد مجاني! 🎁
- سيتم منحك $15 تلقائياً للتجربة
- يكفي لإرسال ~230 رسالة

---

## 🔑 الخطوة 2: الحصول على API Credentials (3 دقائق)

### 1. في لوحة التحكم Twilio Console:

**Account SID:**
- انسخ `Account SID` من الصفحة الرئيسية
- مثال: `ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`

**Auth Token:**
- انسخ `Auth Token` من الصفحة الرئيسية
- اضغط "Show" لإظهاره
- مثال: `your_auth_token_here`

### 2. الحصول على رقم Twilio:

**خطوات:**
1. في القائمة الجانبية: **Phone Numbers** → **Manage** → **Buy a number**
2. اختر دولة (يُفضل USA للتجربة - أرخص!)
3. اختر رقم يدعم SMS
4. اضغط **"Buy"** (مجاني من الرصيد التجريبي!)
5. انسخ الرقم بالصيغة: `+1234567890`

---

## ⚙️ الخطوة 3: إضافة Credentials في Railway (5 دقائق)

### في Railway Dashboard:

1. **افتح مشروعك** `scintillating-balance`
2. **اضغط على** `web` (الخدمة الرئيسية)
3. **اضغط على** تبويب **"Variables"**
4. **اضغط** **"+ New Variable"**

**أضف 3 متغيرات:**

```
Variable Name: TWILIO_ACCOUNT_SID
Value: ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

```
Variable Name: TWILIO_AUTH_TOKEN
Value: your_auth_token_here
```

```
Variable Name: TWILIO_PHONE_NUMBER
Value: +1234567890
```

5. **احفظ** التغييرات
6. **أعد Deploy** الموقع (سيحدث تلقائياً)

---

## ✅ الخطوة 4: اختبار النظام

### بعد إعادة Deploy:

1. **افتح صفحة الموظفين:**
   ```
   https://web-production-0a93a.up.railway.app/staff/dashboard/
   ```

2. **افتح أي استعلام**

3. **اكتب رد على الاستعلام**

4. **اضغط "إرسال الرد"**

5. **✅ يجب أن تصل رسالة SMS للمتعامل!**

---

## 📱 شكل الرسالة

```
مركز شرطة البحيرة
───────────────────
رقم الاستعلام: #INQ-2024-00123

عزيزي المتعامل،
تم الرد على استعلامكم بخصوص البلاغ رقم 1234/2024:

"نص الرد هنا..."

شكراً لتواصلكم معنا
```

---

## 💰 التكلفة

### الحساب التجريبي:
- ✅ $15 رصيد مجاني
- ✅ ~230 رسالة مجانية
- ⚠️ يمكنك فقط إرسال رسائل لأرقام مسجلة (Verified Numbers)

### الحساب المدفوع:
- 💰 $0.0645 لكل رسالة (~0.24 د.إ)
- ✅ إرسال لأي رقم في العالم
- ✅ أرقام الإمارات مدعومة

---

## 🔧 حل المشاكل

### 1. الرسائل لا ترسل - "خدمة الرسائل غير مفعلة"

**السبب:** Credentials غير موجودة في Railway

**الحل:**
- تأكد من إضافة الـ 3 متغيرات في Railway Variables
- أعد Deploy الموقع
- انتظر 2-3 دقائق

### 2. "رقم الهاتف غير صحيح"

**السبب:** صيغة الرقم غير صحيحة

**الحل:**
- تأكد أن الرقم بصيغة: `05xxxxxxxx` أو `5xxxxxxxx`
- النظام يحول تلقائياً إلى `+9715xxxxxxxx`

### 3. "Unverified Number" في الحساب التجريبي

**السبب:** الحساب التجريبي يسمح فقط بإرسال رسائل لأرقام مسجلة

**الحل:**
1. في Twilio Console → **Phone Numbers** → **Verified Caller IDs**
2. اضغط **"Add a new number"**
3. أدخل رقم المتعامل
4. أدخل رمز التحقق المرسل

**أو:**
- قم بترقية الحساب (Upgrade) لإرسال لأي رقم

### 4. التكلفة عالية

**الحل:**
- استخدم أرقام محلية (US numbers أرخص)
- راقب الاستهلاك من Twilio Console → **Usage**
- ضع حد أقصى للصرف: **Account** → **Billing** → **Set spending limit**

---

## 📊 مراقبة الإرسال

### في Twilio Console:

1. **Monitor** → **Logs** → **Mes sages**
   - شوف كل الرسائل المرسلة
   - الحالة (Sent/Delivered/Failed)
   - السبب في حال الفشل

2. **Usage**
   - كم رسالة أرسلت
   - التكلفة الإجمالية

---

## 🎯 نصائح مهمة

1. ✅ احتفظ بـ Credentials بشكل آمن
2. ✅ لا تشارك Auth Token مع أحد
3. ✅ راقب الاستهلاك بانتظام
4. ✅ ضع حد أقصى للصرف
5. ✅ جرب على أرقام مسجلة أولاً
6. ✅ اترقى للحساب المدفوع عند الاستخدام الفعلي

---

## 🔗 روابط مفيدة

- **Twilio Console:** https://www.twilio.com/console
- **Twilio Docs:** https://www.twilio.com/docs/sms
- **Pricing:** https://www.twilio.com/sms/pricing
- **Support:** https://support.twilio.com

---

## ✅ الخلاصة

النظام جاهز! فقط:
1. سجل في Twilio
2. احصل على Credentials
3. أضفها في Railway
4. ابدأ الإرسال! 🚀

**أي مشكلة؟ راجع قسم "حل المشاكل" أو تواصل مع Twilio Support**

