# 📧 دليل إعداد الإيميل - خطوة بخطوة

## ⚠️ المشكلة الحالية:

```
❌ الإيميل لا يُرسل للمتعامل بعد الرد
✅ السبب: لم تتم إضافة Gmail credentials في DigitalOcean
```

---

## ✅ الحل (5 دقائق):

### الخطوة 1️⃣: احصل على Gmail App Password

**1. افتح Google Account:**
```
https://myaccount.google.com/security
```

**2. تأكد من تفعيل 2-Step Verification:**
- اذهب إلى **Security**
- فعّل **2-Step Verification** (إذا مو مفعّل)

**3. أنشئ App Password:**
- في نفس صفحة Security
- اذهب إلى **App Passwords**
- اختر:
  - App: **Mail**
  - Device: **Other** → اكتب "Police Portal"
- اضغط **Generate**

**4. احفظ الـ 16 حرف:**
```
مثال: abcd efgh ijkl mnop
احفظه بدون spaces: abcdefghijklmnop
```

---

### الخطوة 2️⃣: أضف في DigitalOcean

**1. افتح DigitalOcean:**
```
Apps → buhairah-oqh9h → Settings
```

**2. اضغط على Tab:**
```
App-Level Environment Variables
```

**3. اضغط زر "Edit"**

**4. أضف المتغير الأول:**
```
Key: EMAIL_HOST_USER
Value: [إيميلك على Gmail مثل: yourname@gmail.com]
Scope: All components
Encrypt: ✅ (مهم!)
```

**5. اضغط "+Add Variable" وأضف المتغير الثاني:**
```
Key: EMAIL_HOST_PASSWORD
Value: [الـ App Password اللي حصلت عليه من Gmail]
Scope: All components
Encrypt: ✅ (مهم!)
```

**6. اضغط "Save"**

**7. انتظر إعادة النشر التلقائي (2-3 دقائق)**

---

### الخطوة 3️⃣: اختبر الإيميل

**بعد ما ينتهي Deploy، افتح Console وشغّل:**

```bash
python test_email.py
```

**راح يطبع:**
```
✅ الإعدادات موجودة!
📧 محاولة إرسال إيميل تجريبي...
✅ تم إرسال الإيميل التجريبي بنجاح!
   تحقق من بريدك: your-email@gmail.com
```

**تحقق من بريدك Gmail - لازم يوصلك إيميل تجريبي!**

---

## 🎯 بعد الإعداد:

### كيف يعمل النظام:

```
1️⃣ المتعامل يقدم استعلام في الموقع
2️⃣ الموظف يفتح Dashboard ويشوف الاستعلام
3️⃣ الموظف يحجز الاستعلام
4️⃣ الموظف يكتب الرد ويضغط "إرسال"
5️⃣ Django يحفظ الرد في قاعدة البيانات ✅
6️⃣ Django يرسل الإيميل للمتعامل في الخلفية 📧
7️⃣ المتعامل يستلم الرد في بريده ✅
```

---

## 📝 ملاحظات مهمة:

### ✅ الإيميل يُرسل إلى:
```
inquiry.email  → إذا موجود
أو
inquiry.phone  → إذا ما في email (لازم يكون إيميل!)
```

### ⚠️ تأكد من:
```
✅ المتعامل يدخل إيميل صحيح (مو رقم هاتف!)
✅ الإيميل يحتوي على @
✅ مثال صحيح: user@example.com
✅ مثال خطأ: 0501234567
```

---

## 🔍 التحقق من عمل الإيميل:

### طريقة الاختبار الكاملة:

**1. من المتصفح:**
```
• افتح: https://buhairah-oqh9h.ondigitalocean.app/
• اضغط "وزارة الداخلية"
• اختر "الاستعلام عن حالة بلاغ"
• أدخل:
  - رقم البلاغ: 123
  - سنة البلاغ: 2025
  - المركز: مركز شرطة البحيرة
  - البريد الإلكتروني: [إيميلك الحقيقي]
• اضغط "إرسال الاستعلام"
```

**2. سجل دخول كموظف:**
```
• افتح: https://buhairah-oqh9h.ondigitalocean.app/staff/login/
• سجل دخول: 12345 / 12345
• راح تشوف الاستعلام في Dashboard
```

**3. رد على الاستعلام:**
```
• اضغط "حجز" على الاستعلام
• اضغط "الرد"
• اكتب رد (مثال: "تم استلام بلاغكم وجاري المعالجة")
• اضغط "إرسال"
```

**4. تحقق من البريد:**
```
• افتح إيميلك
• لازم يوصلك رسالة من النظام
• الرسالة فيها الرد الكامل بتصميم HTML احترافي
```

---

## ❗ الأخطاء الشائعة:

### 1️⃣ "فشل إرسال البريد: Authentication Error"
```
❌ السبب: App Password غير صحيح
✅ الحل: تأكد من نسخ الـ 16 حرف بدون spaces
```

### 2️⃣ "البريد الإلكتروني غير صحيح"
```
❌ السبب: المتعامل أدخل رقم هاتف بدلاً من إيميل
✅ الحل: تأكد من إدخال إيميل صحيح في النموذج
```

### 3️⃣ الإيميل لا يصل
```
❌ الأسباب المحتملة:
   • App Password مو مفعّل
   • 2-Step Verification مو مفعّل في Gmail
   • الإيميل راح لـ Spam
✅ الحل: تحقق من مجلد Spam في البريد
```

---

## 📊 Gmail Limits:

```
📧 500 إيميل / يوم
📧 100 إيميل / ساعة
⚠️ إذا تجاوزت الحد، Gmail يوقف الحساب مؤقتاً (24 ساعة)
```

---

## 🔗 روابط مفيدة:

```
• Google Security: https://myaccount.google.com/security
• App Passwords: https://myaccount.google.com/apppasswords
• Gmail SMTP Info: https://support.google.com/mail/answer/7126229
```

---

## 🎉 الخلاصة:

```
✅ الكود جاهز ويعمل 100%
✅ فقط تحتاج Gmail App Password
✅ أضفه في DigitalOcean Environment Variables
✅ بعدها الإيميلات راح تُرسل تلقائياً
```

---

## 💡 نصيحة أخيرة:

**استخدم Gmail حقيقي (مو تجريبي) عشان:**
- ✅ أوثق وأأمن
- ✅ ما ينحظر
- ✅ الإيميلات تصل بسرعة
- ✅ ما تروح لـ Spam

---

**🔥 ابدأ من الخطوة 1 واتبع التعليمات بالضبط - راح يشتغل! 🚀**

