{% load static %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إنشاء بلاغ رسمي - {{ report.reference_number }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* Header */
        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 25px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .page-header h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .reference-number {
            background: rgba(255,255,255,0.2);
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 700;
            border: 2px solid rgba(255,255,255,0.3);
        }

        /* Tabs Navigation */
        .tabs-nav {
            background: white;
            display: flex;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .tab-btn {
            flex: 1;
            padding: 18px 20px;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: #7f8c8d;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-btn:hover {
            background: #f8f9fa;
            color: #667eea;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f8f9fa;
        }

        .tab-btn i {
            font-size: 1.1rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            background: white;
            padding: 40px;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Sub Tabs */
        .sub-tabs-nav {
            background: #f8f9fa;
            display: flex;
            gap: 10px;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .sub-tab-btn {
            padding: 12px 24px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sub-tab-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .sub-tab-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }

        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }

        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            color: #34495e;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-label .required {
            color: #e74c3c;
            margin-right: 3px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Party Card */
        .party-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .party-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .party-card.selected {
            border-color: #667eea;
            background: white;
        }

        .party-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .party-type {
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .party-number {
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1rem;
        }

        .badge {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .badge-complainant {
            background: #d4edda;
            color: #155724;
        }

        .badge-accused {
            background: #f8d7da;
            color: #721c24;
        }

        .party-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .info-item {
            display: flex;
            flex-direction: column;
        }

        .info-label {
            color: #7f8c8d;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .info-value {
            color: #2c3e50;
            font-weight: 600;
        }

        /* Party Actions Section */
        .party-actions-section {
            background: white;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            display: none;
        }

        .party-actions-section.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .actions-section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .actions-section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #2c3e50;
        }

        .selected-party-badge {
            background: #667eea;
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        /* Action Modal */
        .action-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .action-modal.active {
            display: flex;
        }

        .action-modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .action-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .action-modal-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .action-modal-close {
            background: #e74c3c;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: 0.3s;
        }

        .action-modal-close:hover {
            background: #c0392b;
            transform: rotate(90deg);
        }

        .action-form-group {
            margin-bottom: 20px;
        }

        .action-form-label {
            display: block;
            font-weight: 700;
            color: #34495e;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .action-form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            background: white;
            transition: 0.3s;
            cursor: pointer;
        }

        .action-form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .action-modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
        }

        .btn-modal-cancel {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-family: 'Tajawal', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-modal-cancel:hover {
            background: #7f8c8d;
        }

        .btn-modal-confirm {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-family: 'Tajawal', sans-serif;
            font-weight: 600;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-modal-confirm:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .party-actions-title {
            font-weight: 700;
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .actions-list {
            display: flex;
            flex-direction: column;
            gap: 0;
            margin-bottom: 15px;
            min-height: 60px;
        }

        .actions-list:empty {
            padding: 30px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #dee2e6;
        }

        .actions-list:empty::before {
            content: "لا توجد إجراءات. اضغط 'إضافة إجراء' لبدء الإضافة";
            color: #95a5a6;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .action-item {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }

        .action-item:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .action-item-header {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: 0.3s;
        }

        .action-item-header:hover {
            background: linear-gradient(to right, #5568d3, #6439a0);
        }

        .action-item-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .action-item-number {
            background: rgba(255, 255, 255, 0.3);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .action-item-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .action-item-toggle i {
            transition: transform 0.3s;
        }

        .action-item.expanded .action-item-toggle i {
            transform: rotate(180deg);
        }

        .action-item-body {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .action-item.expanded .action-item-body {
            max-height: 800px;
        }

        .action-item-content {
            padding: 25px;
            background: #f8f9fa;
        }

        .action-field {
            margin-bottom: 20px;
        }

        .action-field-label {
            display: block;
            font-weight: 700;
            color: #495057;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .action-field-input,
        .action-field-select,
        .action-field-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-family: 'Tajawal', sans-serif;
            font-size: 1rem;
            transition: 0.3s;
        }

        .action-field-input:focus,
        .action-field-select:focus,
        .action-field-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .action-field-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .action-item-footer {
            padding: 15px 25px;
            background: white;
            border-top: 2px solid #e9ecef;
            display: flex;
            justify-content: flex-end;
        }

        .btn-add-action {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-family: 'Tajawal', sans-serif;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }

        .btn-add-action:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        /* Charge Item */
        .charge-item {
            background: #fff3cd;
            border-right: 4px solid #ffc107;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .charge-name {
            font-weight: 700;
            color: #856404;
        }

        .charge-accused {
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #95a5a6;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state p {
            font-size: 1.1rem;
        }

        /* Buttons */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-family: 'Tajawal', sans-serif;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-add {
            background: #28a745;
            color: white;
        }

        .btn-add:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-delete {
            background: #dc3545;
            color: white;
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .btn-delete:hover {
            background: #c82333;
        }

        /* Action Buttons */
        .action-buttons {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            font-size: 1.1rem;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 15px 40px;
            font-size: 1.1rem;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 15px;
            }

            .tabs-nav {
                overflow-x: scroll;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="page-header">
        <h1><i class="fas fa-file-alt"></i> إنشاء بلاغ رسمي</h1>
        <div class="reference-number">
            رقم المرجع: {{ report.reference_number }}
        </div>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs-nav">
        <button type="button" class="tab-btn active" onclick="showMainTab('main-data')">
            <i class="fas fa-info-circle"></i>
            البيانات الرئيسية
        </button>
        <button type="button" class="tab-btn" onclick="showMainTab('parties')">
            <i class="fas fa-users"></i>
            الأطراف
        </button>
        <button type="button" class="tab-btn" onclick="showMainTab('charges')">
            <i class="fas fa-gavel"></i>
            التهم
        </button>
        <button type="button" class="tab-btn" onclick="showMainTab('evidence')">
            <i class="fas fa-box"></i>
            الأشياء العينية
        </button>
        <button type="button" class="tab-btn" onclick="showMainTab('crime-scene')">
            <i class="fas fa-map-marked-alt"></i>
            مسرح الحادث
        </button>
        <button type="button" class="tab-btn" onclick="showMainTab('investigations')">
            <i class="fas fa-search"></i>
            التحقيقات
        </button>
    </div>

    <form method="POST" id="officialReportForm">
        {% csrf_token %}

        <!-- Tab 1: البيانات الرئيسية -->
        <div id="main-data" class="tab-content active">
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">
                        <span class="required">*</span>
                        المركز المختص
                    </label>
                    <input type="text" name="police_center" class="form-input" value="{{ report.police_center }}" required>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="required">*</span>
                        تاريخ إنشاء البلاغ
                    </label>
                    <input type="date" name="report_date" class="form-input" value="{% now 'Y-m-d' %}" required>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="required">*</span>
                        التصنيف
                    </label>
                    <select name="classification" class="form-select" required>
                        <option value="">اختر التصنيف</option>
                        <option value="جنائي" selected>جنائي</option>
                        <option value="عريضة نيابة">عريضة نيابة</option>
                        <option value="إثبات حالة">إثبات حالة</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        تاريخ الواقعة
                    </label>
                    <input type="date" name="incident_date" class="form-input" value="{{ report.incident_date|date:'Y-m-d' }}">
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <span class="required">*</span>
                        التهمة
                    </label>
                    <select name="main_charge" class="form-select" required>
                        <option value="">اختر التهمة</option>
                        <option value="احتيال" {% if report.complaint_type == 'احتيال' %}selected{% endif %}>احتيال</option>
                        <option value="خيانة الأمانة" {% if report.complaint_type == 'خيانة الأمانة' %}selected{% endif %}>خيانة الأمانة</option>
                        <option value="تزوير" {% if report.complaint_type == 'تزوير' %}selected{% endif %}>تزوير</option>
                        <option value="الاعتداء" {% if report.complaint_type == 'الاعتداء' %}selected{% endif %}>الاعتداء</option>
                    </select>
                </div>

                <div class="form-group full-width">
                    <label class="form-label">
                        تفصيل التهمة
                    </label>
                    <textarea name="charge_details" class="form-textarea">{{ report.complaint_subject }}</textarea>
                </div>
            </div>
        </div>

        <!-- Tab 2: الأطراف -->
        <div id="parties" class="tab-content">
            <!-- المبلغ (الشاكي) -->
            <div class="party-card" onclick="toggleParty(this)">
                <div class="party-header">
                    <div class="party-type">
                        <div class="party-number">1</div>
                        المبلغ
                    </div>
                    <span class="badge badge-complainant">مدعي</span>
                </div>
                <div class="party-info">
                    <div class="info-item">
                        <span class="info-label">الاسم الكامل</span>
                        <span class="info-value">{{ report.complainant_name }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">رقم الهوية</span>
                        <span class="info-value">{{ report.complainant_id }}</span>
                    </div>
                </div>
            </div>

            <!-- ملاحظة: بيانات المشكو في حقهم موجودة في إفادة الشاكي -->

            <!-- قسم الإجراءات المنفصل -->
            <div class="party-actions-section" id="actionsSection">
                <div class="actions-section-header">
                    <i class="fas fa-tasks" style="color: #667eea; font-size: 1.5rem;"></i>
                    <div class="actions-section-title">إجراءات الطرف</div>
                    <div class="selected-party-badge" id="selectedPartyName">-</div>
                </div>
                
                <div class="actions-list" id="activeActionsList">
                    <!-- الإجراءات ستُضاف هنا -->
                </div>
                
                <button type="button" class="btn-add-action" id="addActionBtn" onclick="addPartyActionFromSection()">
                    <i class="fas fa-plus"></i> إضافة إجراء
                </button>
            </div>
        </div>

        <!-- Tab 3: التهم -->
        <div id="charges" class="tab-content">
            <div id="chargesList">
                <div class="charge-item">
                    <div>
                        <div class="charge-name">{{ report.complaint_type }}</div>
                        <div class="charge-accused">ضد: جميع المتهمين</div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <button type="button" class="btn btn-add" onclick="addCharge()">
                    <i class="fas fa-plus"></i> إضافة تهمة لمتهم
                </button>
            </div>
        </div>

        <!-- Tab 4: الأشياء العينية -->
        <div id="evidence" class="tab-content">
            <div class="empty-state">
                <i class="fas fa-box-open"></i>
                <p>لم يتم إضافة أشياء عينية بعد</p>
                <p style="font-size: 0.9rem; margin-top: 10px; color: #6c757d;">سيتم إضافة هذا القسم لاحقاً</p>
            </div>
        </div>

        <!-- Tab 5: مسرح الحادث -->
        <div id="crime-scene" class="tab-content">
            <div class="empty-state">
                <i class="fas fa-map-marked"></i>
                <p>لم يتم إضافة معلومات عن مسرح الحادث</p>
                <p style="font-size: 0.9rem; margin-top: 10px; color: #6c757d;">سيتم إضافة هذا القسم لاحقاً</p>
            </div>
        </div>

        <!-- Tab 6: التحقيقات -->
        <div id="investigations" class="tab-content">
            <!-- Sub Tabs -->
            <div class="sub-tabs-nav">
                <button type="button" class="sub-tab-btn active" onclick="showSubTab('file-opening')">
                    <i class="fas fa-folder-open"></i>
                    فتح ملف
                </button>
                <button type="button" class="sub-tab-btn" onclick="showSubTab('summaries')">
                    <i class="fas fa-file-alt"></i>
                    تسجيل ملخصات
                </button>
                {% if report.evidence_description %}
                <button type="button" class="sub-tab-btn" onclick="showSubTab('attachments')">
                    <i class="fas fa-paperclip"></i>
                    المرفقات
                </button>
                {% endif %}
            </div>

            <!-- Sub Tab 1: فتح ملف -->
            <div id="file-opening" class="sub-tab-content active">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">تاريخ فتح الملف</label>
                        <input type="datetime-local" name="file_opening_date" class="form-input" value="{% now 'Y-m-d\TH:i' %}">
                    </div>
                    <div class="form-group">
                        <label class="form-label">رقم الملف</label>
                        <input type="text" name="file_number" class="form-input" value="{{ report.reference_number }}">
                    </div>
                    <div class="form-group full-width">
                        <label class="form-label">ملاحظات فتح الملف</label>
                        <textarea name="file_opening_notes" class="form-textarea" placeholder="أدخل ملاحظات فتح الملف...">تم فتح ملف البلاغ رقم {{ report.reference_number }} بتاريخ {% now 'Y-m-d' %}</textarea>
                    </div>
                </div>
            </div>

            <!-- Sub Tab 2: تسجيل ملخصات -->
            <div id="summaries" class="sub-tab-content">
                <div class="form-group full-width">
                    <label class="form-label">ملخص التحقيق</label>
                    <textarea id="investigationSummary" name="investigation_summary" class="form-textarea" style="min-height: 200px;" placeholder="أدخل ملخص التحقيق..."></textarea>
                </div>
            </div>

            <!-- Sub Tab 3: المرفقات -->
            {% if report.evidence_description %}
            <div id="attachments" class="sub-tab-content">
                <div class="form-group full-width">
                    <label class="form-label">وصف المرفقات والإثباتات</label>
                    <textarea name="attachments_description" class="form-textarea" readonly>{{ report.evidence_description }}</textarea>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button type="button" class="btn btn-secondary" onclick="window.history.back()">
                <i class="fas fa-arrow-right"></i> رجوع
            </button>
            {% if report.status == 'report_created' %}
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> حفظ التغييرات
                </button>
            {% else %}
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> حفظ وإنشاء البلاغ
                </button>
            {% endif %}
        </div>
    </form>

    <script>
        // Main Tabs
        function showMainTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            
            // Add active to clicked button
            event.target.closest('.tab-btn').classList.add('active');
        }

        // Sub Tabs
        function showSubTab(tabId) {
            // Hide all sub tabs
            document.querySelectorAll('.sub-tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all sub buttons
            document.querySelectorAll('.sub-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected sub tab
            document.getElementById(tabId).classList.add('active');
            
            // Add active to clicked button
            event.target.closest('.sub-tab-btn').classList.add('active');
        }

        // متغيرات لحفظ الطرف المختار
        let selectedPartyId = null;
        let selectedPartyName = null;
        let partyActionsData = {}; // لحفظ إجراءات كل طرف

        // Toggle Party Selection
        function toggleParty(partyCard) {
            const actionsSection = document.getElementById('actionsSection');
            const selectedPartyBadge = document.getElementById('selectedPartyName');
            const actionsList = document.getElementById('activeActionsList');
            
            // إذا البطاقة مختارة، نشيلها من الاختيار
            if (partyCard.classList.contains('selected')) {
                partyCard.classList.remove('selected');
                actionsSection.classList.remove('active');
                selectedPartyId = null;
                selectedPartyName = null;
                return;
            }
            
            // نشيل الاختيار من جميع البطاقات
            document.querySelectorAll('.party-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // نختار البطاقة الحالية
            partyCard.classList.add('selected');
            
            // نحصل على معلومات الطرف
            const partyNumber = partyCard.querySelector('.party-number').textContent;
            const partyType = partyCard.querySelector('.party-type').textContent.trim();
            const partyNameElement = partyCard.querySelector('.info-value');
            const partyName = partyNameElement ? partyNameElement.textContent : 'الطرف';
            
            // نحفظ الطرف المختار
            selectedPartyId = `party-${partyNumber}`;
            selectedPartyName = partyName;
            
            // نعرض القسم ونحدث العنوان
            actionsSection.classList.add('active');
            selectedPartyBadge.textContent = partyName;
            
            // نتحقق إذا المبلغ ما عنده إجراءات، نضيف الإجراء التلقائي
            if (selectedPartyId === 'party-1' && (!partyActionsData[selectedPartyId] || partyActionsData[selectedPartyId].length === 0)) {
                createInitialComplainantAction();
            }
            
            // نعرض إجراءات الطرف المختار
            actionsList.innerHTML = '';
            actionCounter = 0; // إعادة تعيين العداد
            if (partyActionsData[selectedPartyId]) {
                partyActionsData[selectedPartyId].forEach((action, index) => {
                    // تحديث رقم الإجراء
                    const numberElement = action.querySelector('.action-item-number');
                    if (numberElement) {
                        numberElement.textContent = index + 1;
                    }
                    actionsList.appendChild(action);
                });
                actionCounter = partyActionsData[selectedPartyId].length;
            }
        }

        // خيارات التصنيف لكل نوع إجراء
        const classificationOptions = {
            'record': [
                { value: 'statement', label: 'إفادة' },
                { value: 'completion', label: 'استكمال' }
            ],
            'document': [
                { value: 'pledge', label: 'تعهد' },
                { value: 'waiver', label: 'تنازل' },
                { value: 'bail', label: 'كفالة' }
            ],
            'attendance': [
                { value: 'present', label: 'حضور' }
            ],
            'arrest': [
                { value: 'arrest', label: 'ضبط' }
            ],
            'detain': [
                { value: 'detain', label: 'حجز' }
            ],
            'release': [
                { value: 'release', label: 'فك حجز' }
            ]
        };

        // تحديث خيارات التصنيف
        function updateActionClassification() {
            const actionType = document.getElementById('actionType').value;
            const classificationSelect = document.getElementById('actionClassification');
            
            // مسح الخيارات الحالية
            classificationSelect.innerHTML = '<option value="">اختر التصنيف</option>';
            
            if (actionType && classificationOptions[actionType]) {
                classificationOptions[actionType].forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.value;
                    optionElement.textContent = option.label;
                    classificationSelect.appendChild(optionElement);
                });
            }
        }

        // فتح نافذة إضافة الإجراء
        function addPartyActionFromSection() {
            if (!selectedPartyId || !selectedPartyName) {
                alert('الرجاء اختيار طرف أولاً!');
                return;
            }
            
            // إعادة تعيين الخيارات
            document.getElementById('actionType').value = '';
            document.getElementById('actionClassification').innerHTML = '<option value="">اختر التصنيف</option>';
            
            // فتح النافذة
            document.getElementById('actionModal').classList.add('active');
        }

        // إغلاق النافذة
        function closeActionModal() {
            document.getElementById('actionModal').classList.remove('active');
        }

        // عداد للإجراءات
        let actionCounter = 0;

        // تأكيد إضافة الإجراء
        function confirmAddAction() {
            const actionType = document.getElementById('actionType').value;
            const classification = document.getElementById('actionClassification').value;
            
            if (!actionType) {
                alert('الرجاء اختيار نوع الإجراء');
                return;
            }
            
            if (!classification) {
                alert('الرجاء اختيار التصنيف');
                return;
            }
            
            // تحديد الاسم
            const actionTypeLabel = document.getElementById('actionType').selectedOptions[0].text;
            const classificationLabel = document.getElementById('actionClassification').selectedOptions[0].text;
            const fullActionName = `${actionTypeLabel} - ${classificationLabel}`;
            
            // زيادة العداد
            actionCounter++;
            const actionId = `action-${selectedPartyId}-${actionCounter}`;
            
            // إنشاء الإجراء
            const now = new Date();
            const dateStr = now.toLocaleDateString('ar-SA');
            const timeStr = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
            const currentDateTime = `${dateStr} ${timeStr}`;
            
            const actionsList = document.getElementById('activeActionsList');
            const actionItem = document.createElement('div');
            actionItem.className = 'action-item';
            actionItem.id = actionId;
            actionItem.innerHTML = `
                <div class="action-item-header" onclick="toggleActionItem('${actionId}')">
                    <div class="action-item-title">
                        <div class="action-item-number">${actionCounter}</div>
                        <span>${fullActionName}</span>
                    </div>
                    <div class="action-item-toggle">
                        <button type="button" class="btn btn-delete" onclick="event.stopPropagation(); removeAction('${actionId}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="action-item-body">
                    <div class="action-item-content">
                        <div class="action-field">
                            <label class="action-field-label">تاريخ الإجراء</label>
                            <input type="datetime-local" class="action-field-input" value="${formatDateTimeForInput(new Date())}">
                        </div>
                        
                        <div class="action-field">
                            <label class="action-field-label">المحقق</label>
                            <input type="text" class="action-field-input" value="{{ request.user.username }}" placeholder="اسم المحقق">
                        </div>
                        
                        <div class="action-field">
                            <label class="action-field-label">نوع الإجراء</label>
                            <input type="text" class="action-field-input" value="${actionTypeLabel}" readonly>
                        </div>
                        
                        <div class="action-field">
                            <label class="action-field-label">الإجراء</label>
                            <input type="text" class="action-field-input" value="${classificationLabel}" readonly>
                        </div>
                        
                        <div class="action-field">
                            <label class="action-field-label">وصف الإجراء</label>
                            <textarea class="action-field-textarea" placeholder="أدخل وصف تفصيلي للإجراء..."></textarea>
                        </div>
                    </div>
                </div>
            `;
            
            // نضيف الإجراء للعرض
            actionsList.appendChild(actionItem);
            
            // نحفظ الإجراء في البيانات
            if (!partyActionsData[selectedPartyId]) {
                partyActionsData[selectedPartyId] = [];
            }
            partyActionsData[selectedPartyId].push(actionItem);
            
            // إغلاق النافذة
            closeActionModal();
            
            // فتح الإجراء الجديد تلقائياً
            setTimeout(() => {
                toggleActionItem(actionId);
            }, 100);
        }

        // تنسيق التاريخ والوقت للـ input
        function formatDateTimeForInput(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        // فتح/إغلاق تفاصيل الإجراء
        function toggleActionItem(actionId) {
            const actionItem = document.getElementById(actionId);
            if (actionItem) {
                actionItem.classList.toggle('expanded');
            }
        }
        
        // حذف إجراء
        function removeAction(actionId) {
            if (!confirm('هل أنت متأكد من حذف هذا الإجراء؟')) {
                return;
            }
            
            const actionItem = document.getElementById(actionId);
            if (!actionItem) return;
            
            // نحذف من البيانات المحفوظة
            if (partyActionsData[selectedPartyId]) {
                const index = partyActionsData[selectedPartyId].indexOf(actionItem);
                if (index > -1) {
                    partyActionsData[selectedPartyId].splice(index, 1);
                }
            }
            
            // نحذف من العرض
            actionItem.remove();
        }

        // Add Charge
        function addCharge() {
            const chargeName = prompt('أدخل اسم التهمة:');
            const accusedName = prompt('أدخل اسم المتهم:');
            
            if (chargeName && chargeName.trim() && accusedName && accusedName.trim()) {
                const chargesList = document.getElementById('chargesList');
                const chargeItem = document.createElement('div');
                chargeItem.className = 'charge-item';
                chargeItem.innerHTML = `
                    <div>
                        <div class="charge-name">${chargeName}</div>
                        <div class="charge-accused">ضد: ${accusedName}</div>
                    </div>
                    <button type="button" class="btn btn-delete" onclick="this.parentElement.remove()">
                        <i class="fas fa-trash"></i> حذف
                    </button>
                `;
                chargesList.appendChild(chargeItem);
            }
        }

        // Generate Investigation Summary
        function generateInvestigationSummary() {
            // بيانات الشاكي
            const complainantName = "{{ report.complainant_name }}";
            const complainantId = "{{ report.complainant_id }}";
            const complainantPhone = "{{ report.complainant_phone }}";
            const complaintType = "{{ report.complaint_type }}";
            
            // بناء النص الأساسي
            let summary = `قدم الشاكي / ${complainantName} ( ${complainantId} ) هـ ( ${complainantPhone} ) بلاغ عبر التطبيق الذكي ضد `;
            
            // المشكو في حقهم
            const accusedParties = {{ report.accused_parties|safe }};
            
            if (accusedParties && accusedParties.length > 0) {
                // المشكو في حقه الأول
                const firstAccused = accusedParties[0];
                const firstName = firstAccused.name || 'مجهول';
                const firstNationality = firstAccused.nationality || 'غير معروفة';
                const firstPhone = firstAccused.phone || 'غير معروف';
                
                // التحقق إذا البيانات ناقصة
                const firstHasCompleteData = firstAccused.name && firstAccused.nationality && firstAccused.phone;
                
                if (firstHasCompleteData) {
                    summary += `المشكو في حقه / ${firstName} ( ${firstNationality} ) هـ ( ${firstPhone} )`;
                } else {
                    let availableData = [];
                    if (firstAccused.name) availableData.push(firstName);
                    if (firstAccused.nationality) availableData.push(`الجنسية: ${firstNationality}`);
                    if (firstAccused.phone) availableData.push(`هـ: ${firstPhone}`);
                    
                    if (availableData.length > 0) {
                        summary += `المشكو في حقه / ${availableData.join(' - ')} ( غير معروف بقية بياناته )`;
                    } else {
                        summary += `المشكو في حقه / مجهول ( غير معروف بقية بياناته )`;
                    }
                }
                
                // باقي المشكو في حقهم
                for (let i = 1; i < accusedParties.length; i++) {
                    const accused = accusedParties[i];
                    const name = accused.name || 'مجهول';
                    const nationality = accused.nationality || 'غير معروفة';
                    const phone = accused.phone || 'غير معروف';
                    
                    const hasCompleteData = accused.name && accused.nationality && accused.phone;
                    
                    if (i === 1) {
                        summary += ' و المشكو في حقه الثاني / ';
                    } else if (i === 2) {
                        summary += ' و المشكو في حقه الثالث / ';
                    } else {
                        summary += ` و المشكو في حقه ${getArabicOrdinal(i + 1)} / `;
                    }
                    
                    if (hasCompleteData) {
                        summary += `${name} ( ${nationality} ) هـ ( ${phone} )`;
                    } else {
                        let availableData = [];
                        if (accused.name) availableData.push(name);
                        if (accused.nationality) availableData.push(`الجنسية: ${nationality}`);
                        if (accused.phone) availableData.push(`هـ: ${phone}`);
                        
                        if (availableData.length > 0) {
                            summary += `${availableData.join(' - ')} ( غير معروف بقية بياناته )`;
                        } else {
                            summary += `مجهول ( غير معروف بقية بياناته )`;
                        }
                    }
                }
            } else {
                summary += 'مجهول ( غير معروف بياناته )';
            }
            
            // نص الشكوى
            const complaintSubject = "{{ report.complaint_subject|escapejs }}";
            summary += ` ويفيد الشاكي عن ${complaintSubject || 'تعرضه للضرر'} من قبل المشكو في حقه ,,`;
            
            return summary;
        }
        
        // دالة مساعدة لتحويل الرقم للترتيب بالعربي
        function getArabicOrdinal(num) {
            const ordinals = {
                4: 'الرابع',
                5: 'الخامس',
                6: 'السادس',
                7: 'السابع',
                8: 'الثامن',
                9: 'التاسع',
                10: 'العاشر'
            };
            return ordinals[num] || `الـ${num}`;
        }
        
        // تعبئة ملخص التحقيق عند تحميل الصفحة
        window.addEventListener('DOMContentLoaded', function() {
            const summaryTextarea = document.getElementById('investigationSummary');
            if (summaryTextarea) {
                summaryTextarea.value = generateInvestigationSummary();
            }
        });

        // Form Submission
        document.getElementById('officialReportForm').addEventListener('submit', function(e) {
            const isAlreadyCreated = "{{ report.status }}" === "report_created";
            
            if (isAlreadyCreated) {
                // إذا كان البلاغ موجود، نسأل عن حفظ التغييرات
                if (!confirm('هل أنت متأكد من حفظ التغييرات؟')) {
                    e.preventDefault();
                }
            } else {
                // إذا كان بلاغ جديد، نسأل عن إنشاء البلاغ
                if (!confirm('هل أنت متأكد من إنشاء البلاغ الرسمي؟\n\nسيتم تغيير حالة البلاغ إلى "تم إنشاء بلاغ"')) {
                    e.preventDefault();
                }
            }
        });

        // Add padding to body for fixed buttons
        document.body.style.paddingBottom = '100px';

        // إنشاء إجراء تلقائي للمبلغ عند تحميل الصفحة
        window.addEventListener('DOMContentLoaded', function() {
            // نتحقق إذا تم تحميل الصفحة لأول مرة وما فيه إجراءات
            const complainantPartyId = 'party-1'; // ID المبلغ
            
            if (!partyActionsData[complainantPartyId] || partyActionsData[complainantPartyId].length === 0) {
                // إنشاء إجراء تلقائي
                createInitialComplainantAction();
            }
        });

        function createInitialComplainantAction() {
            const complainantPartyId = 'party-1';
            
            // بيانات البلاغ
            const complaintSubject = `{{ report.complaint_subject|safe }}`.replace(/&quot;/g, '"');
            const incidentDate = "{{ report.incident_date }}";
            const incidentTime = "{{ report.incident_time }}";
            const incidentLocation = "{{ report.incident_location }}";
            const complaintType = "{{ report.complaint_type }}";
            const relationship = "{{ report.relationship }}";
            const agreementType = "{{ report.agreement_type }}";
            const seizedAmount = "{{ report.seized_amount }}";
            const transferMethod = "{{ report.transfer_method }}";
            const witnesses = `{{ report.witnesses|safe }}`.replace(/&quot;/g, '"');
            const evidence = "{{ report.evidence }}";
            const additionalStatements = `{{ report.additional_statements|safe }}`.replace(/&quot;/g, '"');
            
            // بناء وصف الإجراء
            let actionDescription = "=== إفادة الشاكي ===\n\n";
            actionDescription += `قدم الشاكي / {{ report.complainant_name }} ( {{ report.complainant_id }} ) هـ ( {{ report.complainant_phone }} ) `;
            actionDescription += `بلاغ عبر التطبيق الذكي بتاريخ {{ report.created_at|date:"d/m/Y" }} الساعة {{ report.created_at|date:"H:i" }} `;
            
            // المشكو في حقهم
            const accusedParties = {{ report.accused_parties|safe }};
            if (accusedParties && accusedParties.length > 0) {
                actionDescription += "ضد ";
                accusedParties.forEach((accused, index) => {
                    const name = accused.name || 'مجهول';
                    const nationality = accused.nationality || 'غير معروفة';
                    const phone = accused.phone || 'غير معروف';
                    
                    if (index > 0) {
                        if (index === 1) actionDescription += " و المشكو في حقه الثاني / ";
                        else if (index === 2) actionDescription += " و المشكو في حقه الثالث / ";
                        else actionDescription += " و المشكو في حقه / ";
                    } else {
                        actionDescription += "المشكو في حقه / ";
                    }
                    
                    if (accused.name && accused.nationality && accused.phone) {
                        actionDescription += `${name} ( ${nationality} ) هـ ( ${phone} )`;
                    } else {
                        actionDescription += `${name} ( غير معروف بقية بياناته )`;
                    }
                });
            }
            
            actionDescription += "\n\n=== ماهي بيانات المشكو في حقه ===\n";
            
            // إضافة بيانات المشكو في حقهم بشكل منظم
            if (accusedParties && accusedParties.length > 0) {
                accusedParties.forEach((accused, index) => {
                    const partyNum = index + 1;
                    actionDescription += `\nالطرف ${partyNum}:\n`;
                    actionDescription += `- نوع الطرف: ${accused.type || 'غير محدد'}\n`;
                    actionDescription += `- الاسم: ${accused.name || 'مجهول'}\n`;
                    
                    if (accused.doc_type) {
                        actionDescription += `- نوع الوثيقة: ${accused.doc_type}\n`;
                    }
                    if (accused.nationality) {
                        actionDescription += `- الجنسية: ${accused.nationality}\n`;
                    }
                    if (accused.phone) {
                        actionDescription += `- رقم الهاتف: ${accused.phone}\n`;
                    }
                    if (accused.address) {
                        actionDescription += `- العنوان: ${accused.address}\n`;
                    }
                    
                    // إذا البيانات ناقصة
                    if (!accused.name || !accused.nationality || !accused.phone) {
                        actionDescription += `- ملاحظة: بيانات ناقصة (غير معروف بقية بياناته)\n`;
                    }
                });
            } else {
                actionDescription += "لا يوجد بيانات للمشكو في حقه\n";
            }
            
            actionDescription += "\n\n=== موضوع البلاغ ===\n";
            actionDescription += complaintSubject + "\n\n";
            
            actionDescription += "=== تفاصيل الواقعة ===\n";
            actionDescription += `نوع البلاغ: ${complaintType}\n`;
            actionDescription += `تاريخ الواقعة: ${incidentDate}\n`;
            actionDescription += `وقت الواقعة: ${incidentTime}\n`;
            actionDescription += `مكان الواقعة: ${incidentLocation}\n`;
            
            if (relationship) {
                actionDescription += `طبيعة العلاقة: ${relationship}\n`;
            }
            if (agreementType) {
                actionDescription += `نوع الاتفاق: ${agreementType}\n`;
            }
            if (seizedAmount) {
                actionDescription += `المبلغ المستولى عليه: ${seizedAmount} درهم\n`;
            }
            if (transferMethod) {
                actionDescription += `طريقة التسليم: ${transferMethod}\n`;
            }
            
            if (witnesses) {
                actionDescription += `\n=== الشهود ===\n${witnesses}\n`;
            }
            
            if (evidence) {
                actionDescription += `\n=== الإثباتات المتوفرة ===\n${evidence}\n`;
            }
            
            if (additionalStatements) {
                actionDescription += `\n=== أقوال إضافية ===\n${additionalStatements}\n`;
            }
            
            // إنشاء الإجراء
            actionCounter++;
            const actionId = `action-${complainantPartyId}-${actionCounter}`;
            const now = new Date();
            
            const actionsList = document.getElementById('activeActionsList');
            const actionItem = document.createElement('div');
            actionItem.className = 'action-item';
            actionItem.id = actionId;
            actionItem.innerHTML = `
                <div class="action-item-header" onclick="toggleActionItem('${actionId}')">
                    <div class="action-item-title">
                        <div class="action-item-number">${actionCounter}</div>
                        <span>محضر الاستدلال - الإفادة</span>
                    </div>
                    <div class="action-item-toggle">
                        <button type="button" class="btn btn-delete" onclick="event.stopPropagation(); removeAction('${actionId}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                <div class="action-item-body">
                    <div class="action-item-content">
                        <div class="action-field">
                            <label class="action-field-label">تاريخ الإجراء</label>
                            <input type="datetime-local" class="action-field-input" value="${formatDateTimeForInput(new Date('{{ report.created_at|date:"Y-m-d\\TH:i" }}'))}">
                        </div>
                        
                        <div class="action-field">
                            <label class="action-field-label">المحقق</label>
                            <input type="text" class="action-field-input" value="{{ request.user.username }}" placeholder="اسم المحقق">
                        </div>
                        
                        <div class="action-field">
                            <label class="action-field-label">نوع الإجراء</label>
                            <input type="text" class="action-field-input" value="محضر الاستدلال" readonly>
                        </div>
                        
                        <div class="action-field">
                            <label class="action-field-label">الإجراء</label>
                            <input type="text" class="action-field-input" value="الإفادة" readonly>
                        </div>
                        
                        <div class="action-field">
                            <label class="action-field-label">وصف الإجراء</label>
                            <textarea class="action-field-textarea" style="min-height: 400px;">${actionDescription}</textarea>
                        </div>
                    </div>
                </div>
            `;
            
            // نحفظ الإجراء في البيانات
            if (!partyActionsData[complainantPartyId]) {
                partyActionsData[complainantPartyId] = [];
            }
            partyActionsData[complainantPartyId].push(actionItem);
        }
    </script>

    <!-- Modal لإضافة الإجراء -->
    <div class="action-modal" id="actionModal" onclick="if(event.target === this) closeActionModal()">
        <div class="action-modal-content">
            <div class="action-modal-header">
                <div class="action-modal-title">
                    <i class="fas fa-plus-circle"></i>
                    إضافة إجراء
                </div>
                <button class="action-modal-close" onclick="closeActionModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="action-form-group">
                <label class="action-form-label">نوع الإجراء</label>
                <select class="action-form-select" id="actionType" onchange="updateActionClassification()">
                    <option value="">اختر نوع الإجراء</option>
                    <option value="record">محضر الاستدلال</option>
                    <option value="document">تحرير سند</option>
                    <option value="attendance">حضور</option>
                    <option value="arrest">ضبط</option>
                    <option value="detain">حجز</option>
                    <option value="release">فك حجز</option>
                </select>
            </div>

            <div class="action-form-group">
                <label class="action-form-label">التصنيف</label>
                <select class="action-form-select" id="actionClassification">
                    <option value="">اختر التصنيف</option>
                </select>
            </div>

            <div class="action-modal-footer">
                <button class="btn-modal-cancel" onclick="closeActionModal()">إلغاء</button>
                <button class="btn-modal-confirm" onclick="confirmAddAction()">إضافة</button>
            </div>
        </div>
    </div>
</body>
</html>
